{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport { Button } from 'components/button/button';\nimport { Scrollbar } from 'components/scrollbar/scrollbar';\nimport CheckoutWrapper, { CheckoutContainer, CheckoutInformation, InformationBox, CheckoutSubmit, CartWrapper, CalculationWrapper, OrderInfo, Title, ItemsWrapper, Items, Quantity, Multiplier, ItemInfo, Price, TextWrapper, Text, Bold, Small, NoProductMsg, NoProductImg, WhatsappCheckout } from './checkout-two.style';\nimport { NoCartBag } from 'assets/icons/NoCartBag';\nimport Sticky from 'react-stickynode';\nimport { ProfileContext } from 'contexts/profile/profile.context';\nimport { ConfigContext } from 'contexts/config/config.context';\nimport { FormattedMessage } from 'react-intl';\nimport { useCart } from 'contexts/cart/use-cart';\nimport { useLocale } from 'contexts/language/language.provider';\nimport { useWindowSize } from 'utils/useWindowSize';\nimport createOrder from 'data/use-order'; // import Coupon from 'features/coupon/coupon';\n// import Schedules from 'features/schedule/schedule';\n// import Contact from 'features/contact/contact';\n// import Payment from 'features/payment/payment';\n// import Address from 'features/address/address';\n\nimport UpdateAddress from 'components/address-card/address-card';\nimport CreateOrUpdateContact from 'components/contact-card/contact-card';\n\nconst OrderItem = ({\n  product,\n  config\n}) => {\n  var _config$restaurant, _config$restaurant$us;\n\n  const {\n    id,\n    quantity,\n    title,\n    name,\n    unit,\n    price,\n    salePrice\n  } = product;\n  const displayPrice = salePrice ? salePrice : price;\n  return /*#__PURE__*/_jsxs(Items, {\n    children: [/*#__PURE__*/_jsx(Quantity, {\n      children: quantity\n    }), /*#__PURE__*/_jsx(Multiplier, {\n      children: \"x\"\n    }), /*#__PURE__*/_jsxs(ItemInfo, {\n      children: [name ? name : title, \" \", unit ? `| ${unit}` : '']\n    }), /*#__PURE__*/_jsxs(Price, {\n      children: [config === null || config === void 0 ? void 0 : (_config$restaurant = config.restaurant) === null || _config$restaurant === void 0 ? void 0 : (_config$restaurant$us = _config$restaurant.userConfig) === null || _config$restaurant$us === void 0 ? void 0 : _config$restaurant$us.currency, (displayPrice * quantity).toFixed(2)]\n    })]\n  }, id);\n};\n\nconst CheckoutWithSidebar = ({\n  token,\n  deviceType\n}) => {\n  var _config$qrcode3, _config$restaurant3, _config$qrcode4, _config$restaurant4, _config$qrcode5, _config$restaurant5, _config$restaurant5$u, _config$restaurant6, _config$restaurant6$u, _config$restaurant7, _config$restaurant7$u, _config$restaurant8, _config$restaurant8$u;\n\n  //const [hasCoupon, setHasCoupon] = useState(false);\n  const {\n    state\n  } = useContext(ProfileContext);\n  const {\n    config\n  } = useContext(ConfigContext);\n  const {\n    isRtl\n  } = useLocale();\n  const {\n    items,\n    removeCoupon,\n    coupon,\n    clearCart,\n    cartItemsCount,\n    calculatePrice,\n    calculateDiscount,\n    calculateSubTotalPrice,\n    isRestaurant,\n    toggleRestaurant\n  } = useCart();\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: isValid,\n    1: setIsValid\n  } = useState(false);\n  const {\n    0: createOrderResult,\n    1: setCreateOrderResult\n  } = useState(undefined);\n  const {\n    address,\n    contact,\n    card,\n    schedules\n  } = state;\n  const size = useWindowSize();\n\n  const handleSubmit = async () => {\n    var _config$qrcode, _config$restaurant2;\n\n    setLoading(true);\n\n    if (isValid || config !== null && config !== void 0 && (_config$qrcode = config.qrcode) !== null && _config$qrcode !== void 0 && _config$qrcode.indoor || !(config !== null && config !== void 0 && (_config$restaurant2 = config.restaurant) !== null && _config$restaurant2 !== void 0 && _config$restaurant2.checkout)) {\n      createOrder({\n        config: config,\n        name: contact.length > 0 ? contact[0].name : \"\",\n        note: contact.length > 0 ? contact[0].note : \"\",\n        email: contact.length > 0 ? contact[0].email : \"\",\n        phone: contact.length > 0 ? contact[0].number : \"\",\n        address: address.length > 0 ? address[0].address : \"\",\n        dist: address.length > 0 ? address[0].dist : \"\",\n        aprt: address.length > 0 ? address[0].aprt : \"\",\n        bell: address.length > 0 ? address[0].bell : \"\",\n        house: address.length > 0 ? address[0].house : \"\",\n        lat: address.length > 0 ? address[0].lat : \"\",\n        lng: address.length > 0 ? address[0].lng : \"\",\n        total: calculatePrice(),\n        items: items\n      }).then(response => {\n        return response.text();\n      }).then(text => {\n        setCreateOrderResult(text);\n        setLoading(false);\n      }).catch(error => {\n        console.log(\"An error returned when trying to create an order \" + error.message);\n        setLoading(false);\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (calculatePrice() > 0 && cartItemsCount > 0 && address.length && contact.length //&&\n    //card.length &&\n    //schedules.length\n    ) {\n        setIsValid(true);\n      }\n  }, [state]);\n  useEffect(() => {\n    return () => {\n      if (isRestaurant) {\n        toggleRestaurant();\n        clearCart();\n      }\n    };\n  }, []);\n\n  const handleSendToWhatsApp = () => {\n    //window.open(`https://wa.me/${config?.qrcode?.whatsapp}?text=${createOrderResult}`, '_blank');\n    setTimeout(() => {\n      var _config$qrcode2;\n\n      clearCart();\n      Router.push(`/front?code=${config === null || config === void 0 ? void 0 : (_config$qrcode2 = config.qrcode) === null || _config$qrcode2 === void 0 ? void 0 : _config$qrcode2.qr}`);\n    }, 4000);\n  };\n\n  return /*#__PURE__*/_jsx(\"form\", {\n    children: /*#__PURE__*/_jsx(CheckoutWrapper, {\n      children: /*#__PURE__*/_jsxs(CheckoutContainer, {\n        children: [/*#__PURE__*/_jsxs(CheckoutInformation, {\n          children: [!(config !== null && config !== void 0 && (_config$qrcode3 = config.qrcode) !== null && _config$qrcode3 !== void 0 && _config$qrcode3.indoor) && config !== null && config !== void 0 && (_config$restaurant3 = config.restaurant) !== null && _config$restaurant3 !== void 0 && _config$restaurant3.checkout ? /*#__PURE__*/_jsxs(InformationBox, {\n            children: [/*#__PURE__*/_jsx(UpdateAddress, {\n              item: address,\n              config: config\n            }), /*#__PURE__*/_jsx(CreateOrUpdateContact, {\n              item: contact,\n              config: config\n            })]\n          }) // <InformationBox>\n          //   {/* <UpdateAddress/> */}\n          //   <Address\n          //     increment={true}\n          //     flexStart={true}\n          //     buttonProps={{\n          //       variant: 'text',\n          //       type: 'button',\n          //       className: 'addButton',\n          //     }}\n          //     icon={true}\n          //     config={config}\n          //   />\n          // </InformationBox>\n          : null, /*#__PURE__*/_jsx(InformationBox, {\n            className: \"paymentBox\",\n            style: {\n              paddingBottom: 30\n            },\n            children: /*#__PURE__*/_jsx(CheckoutSubmit, {\n              children: !createOrderResult ? /*#__PURE__*/_jsx(Button, {\n                type: \"button\",\n                onClick: handleSubmit,\n                disabled: !isValid && !(config !== null && config !== void 0 && (_config$qrcode4 = config.qrcode) !== null && _config$qrcode4 !== void 0 && _config$qrcode4.indoor) && (config === null || config === void 0 ? void 0 : (_config$restaurant4 = config.restaurant) === null || _config$restaurant4 === void 0 ? void 0 : _config$restaurant4.checkout),\n                size: \"big\",\n                loading: loading,\n                style: {\n                  width: '100%'\n                },\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"processCheckout\",\n                  defaultMessage: \"Proceed to Checkout\"\n                })\n              }) : /*#__PURE__*/_jsx(WhatsappCheckout, {\n                href: `https://wa.me/${config === null || config === void 0 ? void 0 : (_config$qrcode5 = config.qrcode) === null || _config$qrcode5 === void 0 ? void 0 : _config$qrcode5.whatsapp}?text=${createOrderResult}`,\n                target: \"_blank\",\n                onClick: handleSendToWhatsApp,\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"processWhatsapp\",\n                  defaultMessage: \"Order created successfully, click to send it to restaurant Whatsapp account\"\n                })\n              })\n            })\n          })]\n        }), /*#__PURE__*/_jsx(CartWrapper, {\n          children: /*#__PURE__*/_jsx(Sticky, {\n            enabled: size.width >= 768 ? true : false,\n            top: 120,\n            innerZ: 999,\n            children: /*#__PURE__*/_jsxs(OrderInfo, {\n              children: [/*#__PURE__*/_jsx(Title, {\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"cartTitle\",\n                  defaultMessage: \"Your Order\"\n                })\n              }), /*#__PURE__*/_jsx(Scrollbar, {\n                className: \"checkout-scrollbar\",\n                children: /*#__PURE__*/_jsx(ItemsWrapper, {\n                  children: cartItemsCount > 0 ? items.map(item => /*#__PURE__*/_jsx(OrderItem, {\n                    product: item,\n                    config: config\n                  }, `cartItem-${item.id}`)) : /*#__PURE__*/_jsxs(_Fragment, {\n                    children: [/*#__PURE__*/_jsx(NoProductImg, {\n                      children: /*#__PURE__*/_jsx(NoCartBag, {})\n                    }), /*#__PURE__*/_jsx(NoProductMsg, {\n                      children: /*#__PURE__*/_jsx(FormattedMessage, {\n                        id: \"noProductFound\",\n                        defaultMessage: \"No products found\"\n                      })\n                    })]\n                  })\n                })\n              }), /*#__PURE__*/_jsxs(CalculationWrapper, {\n                children: [/*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"subTotal\",\n                      defaultMessage: \"Subtotal\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant5 = config.restaurant) === null || _config$restaurant5 === void 0 ? void 0 : (_config$restaurant5$u = _config$restaurant5.userConfig) === null || _config$restaurant5$u === void 0 ? void 0 : _config$restaurant5$u.currency, calculateSubTotalPrice()]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"intlOrderDetailsDelivery\",\n                      defaultMessage: \"Delivery Fee\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant6 = config.restaurant) === null || _config$restaurant6 === void 0 ? void 0 : (_config$restaurant6$u = _config$restaurant6.userConfig) === null || _config$restaurant6$u === void 0 ? void 0 : _config$restaurant6$u.currency, \" 0.00\"]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"discountText\",\n                      defaultMessage: \"Discount\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant7 = config.restaurant) === null || _config$restaurant7 === void 0 ? void 0 : (_config$restaurant7$u = _config$restaurant7.userConfig) === null || _config$restaurant7$u === void 0 ? void 0 : _config$restaurant7$u.currency, calculateDiscount()]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  style: {\n                    marginTop: 20\n                  },\n                  children: [/*#__PURE__*/_jsxs(Bold, {\n                    children: [/*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"totalText\",\n                      defaultMessage: \"Total\"\n                    }), ' ', /*#__PURE__*/_jsxs(Small, {\n                      children: [\"(\", /*#__PURE__*/_jsx(FormattedMessage, {\n                        id: \"vatText\",\n                        defaultMessage: \"Incl. VAT\"\n                      }), \")\"]\n                    })]\n                  }), /*#__PURE__*/_jsxs(Bold, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant8 = config.restaurant) === null || _config$restaurant8 === void 0 ? void 0 : (_config$restaurant8$u = _config$restaurant8.userConfig) === null || _config$restaurant8$u === void 0 ? void 0 : _config$restaurant8$u.currency, calculatePrice()]\n                  })]\n                })]\n              })]\n            })\n          })\n        })]\n      })\n    })\n  });\n};\n\nexport default CheckoutWithSidebar;","map":null,"metadata":{},"sourceType":"module"}