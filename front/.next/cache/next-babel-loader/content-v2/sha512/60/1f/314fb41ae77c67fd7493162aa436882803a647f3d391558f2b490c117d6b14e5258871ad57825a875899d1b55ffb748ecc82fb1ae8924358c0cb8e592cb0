{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/home/whatsappneed.com/public_html/front/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/whatsappneed.com/public_html/front/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport { Button } from 'components/button/button';\nimport { Scrollbar } from 'components/scrollbar/scrollbar';\nimport CheckoutWrapper, { CheckoutContainer, CheckoutInformation, InformationBox, CheckoutSubmit, CartWrapper, CalculationWrapper, OrderInfo, Title, ItemsWrapper, Items, Quantity, Multiplier, ItemInfo, Price, TextWrapper, Text, Bold, Small, NoProductMsg, NoProductImg, WhatsappCheckout } from './checkout-two.style';\nimport { NoCartBag } from 'assets/icons/NoCartBag';\nimport Sticky from 'react-stickynode';\nimport { ProfileContext } from 'contexts/profile/profile.context';\nimport { ConfigContext } from 'contexts/config/config.context';\nimport { FormattedMessage } from 'react-intl';\nimport { useCart } from 'contexts/cart/use-cart';\nimport { useLocale } from 'contexts/language/language.provider';\nimport { useWindowSize } from 'utils/useWindowSize';\nimport createOrder from 'data/use-order'; // import Coupon from 'features/coupon/coupon';\n// import Schedules from 'features/schedule/schedule';\n// import Contact from 'features/contact/contact';\n// import Payment from 'features/payment/payment';\n// import Address from 'features/address/address';\n\nimport UpdateAddress from 'components/address-card/address-card';\nimport CreateOrUpdateContact from 'components/contact-card/contact-card';\n\nvar OrderItem = function OrderItem(_ref) {\n  var _config$restaurant, _config$restaurant$us;\n\n  var product = _ref.product,\n      config = _ref.config;\n  var id = product.id,\n      quantity = product.quantity,\n      title = product.title,\n      name = product.name,\n      unit = product.unit,\n      price = product.price,\n      salePrice = product.salePrice;\n  var displayPrice = salePrice ? salePrice : price;\n  return /*#__PURE__*/_jsxs(Items, {\n    children: [/*#__PURE__*/_jsx(Quantity, {\n      children: quantity\n    }), /*#__PURE__*/_jsx(Multiplier, {\n      children: \"x\"\n    }), /*#__PURE__*/_jsxs(ItemInfo, {\n      children: [name ? name : title, \" \", unit ? \"| \".concat(unit) : '']\n    }), /*#__PURE__*/_jsxs(Price, {\n      children: [config === null || config === void 0 ? void 0 : (_config$restaurant = config.restaurant) === null || _config$restaurant === void 0 ? void 0 : (_config$restaurant$us = _config$restaurant.userConfig) === null || _config$restaurant$us === void 0 ? void 0 : _config$restaurant$us.currency, (displayPrice * quantity).toFixed(2)]\n    })]\n  }, id);\n};\n\nvar CheckoutWithSidebar = function CheckoutWithSidebar(_ref2) {\n  var _config$qrcode3, _config$restaurant3, _config$qrcode4, _config$restaurant4, _config$qrcode5, _config$restaurant5, _config$restaurant5$u, _config$restaurant6, _config$restaurant6$u, _config$restaurant7, _config$restaurant7$u, _config$restaurant8, _config$restaurant8$u;\n\n  var token = _ref2.token,\n      deviceType = _ref2.deviceType;\n\n  //const [hasCoupon, setHasCoupon] = useState(false);\n  var _useContext = useContext(ProfileContext),\n      state = _useContext.state;\n\n  var _useContext2 = useContext(ConfigContext),\n      config = _useContext2.config;\n\n  var _useLocale = useLocale(),\n      isRtl = _useLocale.isRtl;\n\n  var _useCart = useCart(),\n      items = _useCart.items,\n      removeCoupon = _useCart.removeCoupon,\n      coupon = _useCart.coupon,\n      clearCart = _useCart.clearCart,\n      cartItemsCount = _useCart.cartItemsCount,\n      calculatePrice = _useCart.calculatePrice,\n      calculateDiscount = _useCart.calculateDiscount,\n      calculateSubTotalPrice = _useCart.calculateSubTotalPrice,\n      isRestaurant = _useCart.isRestaurant,\n      toggleRestaurant = _useCart.toggleRestaurant;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      isValid = _useState2[0],\n      setIsValid = _useState2[1];\n\n  var _useState3 = useState(undefined),\n      createOrderResult = _useState3[0],\n      setCreateOrderResult = _useState3[1];\n\n  var address = state.address,\n      contact = state.contact,\n      card = state.card,\n      schedules = state.schedules;\n  var size = useWindowSize();\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _config$qrcode, _config$restaurant2;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n\n              if (isValid || config !== null && config !== void 0 && (_config$qrcode = config.qrcode) !== null && _config$qrcode !== void 0 && _config$qrcode.indoor || !(config !== null && config !== void 0 && (_config$restaurant2 = config.restaurant) !== null && _config$restaurant2 !== void 0 && _config$restaurant2.checkout)) {\n                createOrder({\n                  config: config,\n                  name: contact.length > 0 ? contact[0].name : \"\",\n                  note: contact.length > 0 ? contact[0].note : \"\",\n                  email: contact.length > 0 ? contact[0].email : \"\",\n                  phone: contact.length > 0 ? contact[0].number : \"\",\n                  address: address.length > 0 ? address[0].address : \"\",\n                  dist: address.length > 0 ? address[0].dist : \"\",\n                  aprt: address.length > 0 ? address[0].aprt : \"\",\n                  bell: address.length > 0 ? address[0].bell : \"\",\n                  house: address.length > 0 ? address[0].house : \"\",\n                  lat: address.length > 0 ? address[0].lat : \"\",\n                  lng: address.length > 0 ? address[0].lng : \"\",\n                  total: calculatePrice(),\n                  items: items\n                }).then(function (response) {\n                  return response.text();\n                }).then(function (text) {\n                  setCreateOrderResult(text);\n                  setLoading(false);\n                })[\"catch\"](function (error) {\n                  console.log(\"An error returned when trying to create an order \" + error.message);\n                  setLoading(false);\n                });\n              }\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (calculatePrice() > 0 && cartItemsCount > 0 && address.length && contact.length //&&\n    //card.length &&\n    //schedules.length\n    ) {\n        setIsValid(true);\n      }\n  }, [state]);\n  useEffect(function () {\n    return function () {\n      if (isRestaurant) {\n        toggleRestaurant();\n        clearCart();\n      }\n    };\n  }, []);\n\n  var handleSendToWhatsApp = function handleSendToWhatsApp() {\n    //window.open(`https://wa.me/${config?.qrcode?.whatsapp}?text=${createOrderResult}`, '_blank');\n    setTimeout(function () {\n      var _config$qrcode2;\n\n      clearCart();\n      Router.push(\"/front?code=\".concat(config === null || config === void 0 ? void 0 : (_config$qrcode2 = config.qrcode) === null || _config$qrcode2 === void 0 ? void 0 : _config$qrcode2.qr));\n    }, 4000);\n  };\n\n  return /*#__PURE__*/_jsx(\"form\", {\n    children: /*#__PURE__*/_jsx(CheckoutWrapper, {\n      children: /*#__PURE__*/_jsxs(CheckoutContainer, {\n        children: [/*#__PURE__*/_jsxs(CheckoutInformation, {\n          children: [!(config !== null && config !== void 0 && (_config$qrcode3 = config.qrcode) !== null && _config$qrcode3 !== void 0 && _config$qrcode3.indoor) && config !== null && config !== void 0 && (_config$restaurant3 = config.restaurant) !== null && _config$restaurant3 !== void 0 && _config$restaurant3.checkout ? /*#__PURE__*/_jsxs(InformationBox, {\n            children: [/*#__PURE__*/_jsx(UpdateAddress, {\n              item: address,\n              config: config\n            }), /*#__PURE__*/_jsx(CreateOrUpdateContact, {\n              item: contact,\n              config: config\n            })]\n          }) // <InformationBox>\n          //   {/* <UpdateAddress/> */}\n          //   <Address\n          //     increment={true}\n          //     flexStart={true}\n          //     buttonProps={{\n          //       variant: 'text',\n          //       type: 'button',\n          //       className: 'addButton',\n          //     }}\n          //     icon={true}\n          //     config={config}\n          //   />\n          // </InformationBox>\n          : null, /*#__PURE__*/_jsx(InformationBox, {\n            className: \"paymentBox\",\n            style: {\n              paddingBottom: 30\n            },\n            children: /*#__PURE__*/_jsx(CheckoutSubmit, {\n              children: !createOrderResult ? /*#__PURE__*/_jsx(Button, {\n                type: \"button\",\n                onClick: handleSubmit,\n                disabled: !isValid && !(config !== null && config !== void 0 && (_config$qrcode4 = config.qrcode) !== null && _config$qrcode4 !== void 0 && _config$qrcode4.indoor) && (config === null || config === void 0 ? void 0 : (_config$restaurant4 = config.restaurant) === null || _config$restaurant4 === void 0 ? void 0 : _config$restaurant4.checkout),\n                size: \"big\",\n                loading: loading,\n                style: {\n                  width: '100%'\n                },\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"processCheckout\",\n                  defaultMessage: \"Proceed to Checkout\"\n                })\n              }) : /*#__PURE__*/_jsx(WhatsappCheckout, {\n                href: \"https://wa.me/\".concat(config === null || config === void 0 ? void 0 : (_config$qrcode5 = config.qrcode) === null || _config$qrcode5 === void 0 ? void 0 : _config$qrcode5.whatsapp, \"?text=\").concat(createOrderResult),\n                target: \"_blank\",\n                onClick: handleSendToWhatsApp,\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"processWhatsapp\",\n                  defaultMessage: \"Order created successfully, click to send it to restaurant Whatsapp account\"\n                })\n              })\n            })\n          })]\n        }), /*#__PURE__*/_jsx(CartWrapper, {\n          children: /*#__PURE__*/_jsx(Sticky, {\n            enabled: size.width >= 768 ? true : false,\n            top: 120,\n            innerZ: 999,\n            children: /*#__PURE__*/_jsxs(OrderInfo, {\n              children: [/*#__PURE__*/_jsx(Title, {\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"cartTitle\",\n                  defaultMessage: \"Your Order\"\n                })\n              }), /*#__PURE__*/_jsx(Scrollbar, {\n                className: \"checkout-scrollbar\",\n                children: /*#__PURE__*/_jsx(ItemsWrapper, {\n                  children: cartItemsCount > 0 ? items.map(function (item) {\n                    return /*#__PURE__*/_jsx(OrderItem, {\n                      product: item,\n                      config: config\n                    }, \"cartItem-\".concat(item.id));\n                  }) : /*#__PURE__*/_jsxs(_Fragment, {\n                    children: [/*#__PURE__*/_jsx(NoProductImg, {\n                      children: /*#__PURE__*/_jsx(NoCartBag, {})\n                    }), /*#__PURE__*/_jsx(NoProductMsg, {\n                      children: /*#__PURE__*/_jsx(FormattedMessage, {\n                        id: \"noProductFound\",\n                        defaultMessage: \"No products found\"\n                      })\n                    })]\n                  })\n                })\n              }), /*#__PURE__*/_jsxs(CalculationWrapper, {\n                children: [/*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"subTotal\",\n                      defaultMessage: \"Subtotal\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant5 = config.restaurant) === null || _config$restaurant5 === void 0 ? void 0 : (_config$restaurant5$u = _config$restaurant5.userConfig) === null || _config$restaurant5$u === void 0 ? void 0 : _config$restaurant5$u.currency, calculateSubTotalPrice()]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"intlOrderDetailsDelivery\",\n                      defaultMessage: \"Delivery Fee\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant6 = config.restaurant) === null || _config$restaurant6 === void 0 ? void 0 : (_config$restaurant6$u = _config$restaurant6.userConfig) === null || _config$restaurant6$u === void 0 ? void 0 : _config$restaurant6$u.currency, \" 0.00\"]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"discountText\",\n                      defaultMessage: \"Discount\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant7 = config.restaurant) === null || _config$restaurant7 === void 0 ? void 0 : (_config$restaurant7$u = _config$restaurant7.userConfig) === null || _config$restaurant7$u === void 0 ? void 0 : _config$restaurant7$u.currency, calculateDiscount()]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  style: {\n                    marginTop: 20\n                  },\n                  children: [/*#__PURE__*/_jsxs(Bold, {\n                    children: [/*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"totalText\",\n                      defaultMessage: \"Total\"\n                    }), ' ', /*#__PURE__*/_jsxs(Small, {\n                      children: [\"(\", /*#__PURE__*/_jsx(FormattedMessage, {\n                        id: \"vatText\",\n                        defaultMessage: \"Incl. VAT\"\n                      }), \")\"]\n                    })]\n                  }), /*#__PURE__*/_jsxs(Bold, {\n                    children: [config === null || config === void 0 ? void 0 : (_config$restaurant8 = config.restaurant) === null || _config$restaurant8 === void 0 ? void 0 : (_config$restaurant8$u = _config$restaurant8.userConfig) === null || _config$restaurant8$u === void 0 ? void 0 : _config$restaurant8$u.currency, calculatePrice()]\n                  })]\n                })]\n              })]\n            })\n          })\n        })]\n      })\n    })\n  });\n};\n\nexport default CheckoutWithSidebar;","map":null,"metadata":{},"sourceType":"module"}